<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders - Inventory Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/stylesheet.css" rel="stylesheet">
</head>
<body>
<div class="d-flex" style="min-height: 100vh;">
    <!-- Sidebar -->
    <nav class="sidebar p-3 d-flex flex-column">
        <div class="mb-4 mt-2">
            <span class="fs-4 fw-bold text-primary">Inventory System</span>
        </div>
        <ul class="nav flex-column gap-2">
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center" href="products.html">
                    <i class="bi bi-box-seam me-2"></i> Products
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active d-flex align-items-center" href="orders.html">
                    <i class="bi bi-calendar2-check me-2"></i> Orders
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center" href="bookings.html">
                    <i class="bi bi-calendar-check me-2"></i> Bookings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center" href="#" id="adminPanelToggle">
                    <i class="bi bi-gear me-2"></i> Admin Panel
                    <i class="bi bi-chevron-down ms-auto" id="adminPanelIcon"></i>
                </a>
                <ul class="nav flex-column gap-1 ms-3" id="adminSubmenu" style="display: none;">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="user-management.html">
                            <i class="bi bi-people me-2"></i> User Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="business-management.html">
                            <i class="bi bi-building me-2"></i> Business Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="tenant-management.html">
                            <i class="bi bi-shop me-2"></i> Tenant Management
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="flex-grow-1">
        <!-- Top Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn btn-info">
                    <i class="bi bi-list"></i>
                </button>
                <div class="ms-auto">
                    <button class="btn btn-outline-secondary" onclick="logout()">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Page Content -->
        <div class="container-fluid p-4">
            <div class="row mb-4">
                <div class="col">
                    <h4 class="mb-0">Orders</h4>
                    <p class="text-muted">View and manage orders</p>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <select id="tenantSelect" class="form-select" onchange="handleTenantChange()">
                        <option value="">Select Tenant</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select id="dateRangeSelect" class="form-select" onchange="handleDateRangeChange()">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="all">All</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div id="customDateRange" class="col-md-4 d-none">
                    <div class="input-group">
                        <input type="date" id="startDate" class="form-control" onchange="handleCustomDateChange()">
                        <input type="date" id="endDate" class="form-control" onchange="handleCustomDateChange()">
                    </div>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-primary" onclick="refreshOrders()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs mb-4" id="orderTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="booked-tab" data-bs-toggle="tab" data-bs-target="#booked" type="button" role="tab" aria-controls="booked" aria-selected="true">Booked Orders</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="requested-tab" data-bs-toggle="tab" data-bs-target="#requested" type="button" role="tab" aria-controls="requested" aria-selected="false">Requested Orders</button>
                </li>
            </ul>

            <!-- Status Buttons -->
            <div class="btn-group mb-4" role="group" aria-label="Order status filter">
                <button type="button" class="btn btn-outline-primary active" data-status="all">All</button>
                <button type="button" class="btn btn-outline-primary" data-status="New">New</button>
                <button type="button" class="btn btn-outline-primary" data-status="InProgress">In Progress</button>
                <button type="button" class="btn btn-outline-primary" data-status="Done">Done</button>
            </div>

            <!-- Orders Table -->
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Order Date</th>
                            <th>Dealer Name</th>
                            <th>Total Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Orders will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="text-center d-none">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <!-- No Orders Message -->
            <div id="noOrdersMessage" class="text-center d-none">
                <p class="text-muted">No orders found</p>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi me-2"></i>
            <strong class="me-auto" id="toastTitle">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderDetailsModalLabel">Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Order Information</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Order ID:</th>
                                <td id="detailOrderId">-</td>
                            </tr>
                            <tr>
                                <th>Order Date:</th>
                                <td id="detailOrderDate">-</td>
                            </tr>
                            <tr>
                                <th>Status:</th>
                                <td id="detailOrderStatus">-</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Dealer Information</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Name:</th>
                                <td id="detailDealerName">-</td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td id="detailDealerEmail">-</td>
                            </tr>
                            <tr>
                                <th>Phone:</th>
                                <td id="detailDealerPhone">-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <h6>Order Items</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Discount</th>
                                <th>Tax</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="orderItemsTableBody">
                            <!-- Order items will be populated here -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="5" class="text-end">Total Amount:</th>
                                <td id="detailTotalAmount">-</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Order Status Update Modal -->
<div class="modal fade" id="statusUpdateModal" tabindex="-1" aria-labelledby="statusUpdateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statusUpdateModalLabel">Update Order Status</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <select id="orderStatusSelect" class="form-select">
                    <option value="New">New</option>
                    <option value="InProgress">In Progress</option>
                    <option value="Done">Done</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="updateOrderStatus()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/main.js"></script>
    <script src="js/orders.js"></script>
    <script src="js/sidebar.js"></script>
</body>
</html>
